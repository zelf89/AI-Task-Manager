<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Task Manager</title>
<style>
    body {
        font-family: Arial, sans-serif;
        background: #f9f9f9;
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        height: 100vh;
        flex-direction: column; /* Ensure the layout stacks vertically on mobile */
    }

    .container {
        display: flex;
        flex-direction: row; /* Stack the elements vertically */
        width: 90%;
        max-width: 1200px;
        margin-top: 20px;
        padding: 20px;
        background: #fff;
        box-shadow: 0 0 15px rgba(0, 0, 0, 0.1);
        border-radius: 10px;
        height: 100%;
        min-height: 0;
    }

    /* Chatbox */
    .chatbox {
        width: 100%; /* Make it 100% width */
        display: flex;
        flex-direction: column;
        padding: 10px;
        background: #f1f1f1;
        border-radius: 10px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
        flex: 1;
        min-height: 0;
    }

    #chatMessages {
        flex: 1;
        max-height: 500px;
        overflow-y: auto;
        padding: 10px;
        background: #e9e9e9;
        border-radius: 5px;
        margin-bottom: 10px;
        display: flex;
        flex-direction: column;
    }

    .chat-message {
        max-width: 70%;
        padding: 8px 12px;
        margin: 5px 0;
        border-radius: 15px;
        word-wrap: break-word;
    }

    .chat-message.user {
        align-self: flex-end;
        background: #007BFF;
        color: white;
        border-bottom-right-radius: 0;
    }

    .chat-message.bot {
        align-self: flex-start;
        background: #e0e0e0;
        color: black;
        border-bottom-left-radius: 0;
    }

    #chatInputDiv {
        display: flex;
        margin-top: auto;  /* Pushes input box to the bottom */
    }

    #chatInput {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    #chatInputDiv button {
        margin-left: 10px;
        padding: 10px 15px;
        border: none;
        background: #28a745;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }

    #chatInputDiv button:hover { background: #1e7e34; }

    /* Task Manager */
    .task-manager {
        width: 100%; /* Make it 100% width */
        flex: 1;
        display: flex;
        flex-direction: column;
        padding: 10px;
        min-height: 0;
    }

    h1 {
        text-align: center;
        margin-bottom: 20px;
    }

    /* Task Input */
    #taskInputDiv {
        display: flex;
        margin-bottom: 15px;
    }

    #taskTitle {
        flex: 1;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ccc;
    }

    #taskInputDiv button {
        margin-left: 10px;
        padding: 10px 15px;
        border: none;
        background: #007BFF;
        color: white;
        border-radius: 5px;
        cursor: pointer;
    }

    #taskInputDiv button:hover { background: #0056b3; }

    /* Task Lists Columns */
    .task-columns {
        display: flex;
        justify-content: space-between;
        margin-bottom: 20px;
        flex-grow: 1;
        flex-wrap: wrap; /* Ensure it wraps on smaller screens */
    }

    .task-column {
        width: 48%;
        margin-bottom: 20px; /* Add some space between columns on smaller screens */
    }

    ul {
        list-style: none;
        padding: 0;
        margin: 0;
    }

    li {
        display: flex;
        justify-content: space-between;
        padding: 8px 0;
        border-bottom: 1px solid #eee;
    }

    li button {
        margin-left: 5px;
        padding: 5px 8px;
        font-size: 14px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
    }

    li button:hover { opacity: 0.8; }

    /* Media Queries for Small Screens (Mobile) */
    @media (max-width: 768px) {
        .container {
            flex-direction: column; /* Stack the elements vertically */
          
        }

        .task-manager,
        .chatbox {
            width: 100%; /* Full width on mobile */
            margin-bottom: 20px; /* Space between sections */
        }

        .task-columns {
            flex-direction: column; /* Stack task columns vertically on mobile */
        }

        .task-column {
            width: 100%; /* Ensure each task column takes full width on small screens */
        }
    }
</style>

</head>
<body>
<div class="container">
    <!-- Chatbot -->
    <div class="chatbox">
        <div id="chatMessages"></div>
        <div id="chatInputDiv">
            <input type="text" id="chatInput" placeholder="Ask AI...">
            <button onclick="sendChat()">Send</button>
        </div>
    </div>

    <!-- Task Manager -->
    <div class="task-manager">
        <h1>AI Task Manager</h1>

        <!-- Task Input -->
        <div id="taskInputDiv">
            <input type="text" id="taskTitle" placeholder="New task title">
            <button onclick="addTask()">Add Task</button>
        </div>

        <!-- Task Lists Columns -->
        <div class="task-columns">
            <div class="task-column">
                <h3>Pending Tasks</h3>
                <ul id="pendingTasks"></ul>
            </div>
            <div class="task-column">
                <h3>Completed Tasks</h3>
                <ul id="completedTasks"></ul>
            </div>
        </div>
    </div>
</div>

<script>
const API_URL = "/api/v1/todos";
const CHAT_URL = "/chat";

// --- Load tasks ---
async function loadTasks() {
    const res = await fetch(API_URL);
    const tasks = await res.json();

    const pendingList = document.getElementById("pendingTasks");
    const completedList = document.getElementById("completedTasks");

    pendingList.innerHTML = "";
    completedList.innerHTML = "";

    tasks.forEach(task => {
        const li = document.createElement("li");
        li.textContent = `Task ${task.id}: ${task.title} - ${task.completed ? "✅ Completed" : "⏳ Pending"}`;

        // Toggle complete / undo button
        const btnToggle = document.createElement("button");
        btnToggle.textContent = task.completed ? "↩ Undo" : "✓ Complete";
        btnToggle.onclick = () => toggleComplete(task.id, !task.completed);

        // Delete button
        const btnDelete = document.createElement("button");
        btnDelete.textContent = "🗑 Delete";
        btnDelete.onclick = () => deleteTask(task.id);

        li.appendChild(btnToggle);
        li.appendChild(btnDelete);

        if (task.completed) {
            completedList.appendChild(li);
        } else {
            pendingList.appendChild(li);
        }
    });
}

// --- Toggle complete / undo ---
async function toggleComplete(id, completed) {
    await fetch(`${API_URL}/${id}`, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ completed })
    });
    loadTasks();
}

// --- Add task ---
async function addTask() {
    const title = document.getElementById("taskTitle").value;
    if(!title) return;
    await fetch(API_URL, {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({title})
    });
    document.getElementById("taskTitle").value = "";
    loadTasks();
}

// --- Delete task ---
async function deleteTask(id) {
    await fetch(`${API_URL}/${id}`, { method: "DELETE" });
    loadTasks();
}

// --- Chatbot ---
// async function sendChat() {
//     const input = document.getElementById("chatInput");
//     const msg = input.value;
//     if(!msg) return;

//     const chatBox = document.getElementById("chatMessages");

//     // User message (right)
//     const userMsg = document.createElement("div");
//     userMsg.className = "chat-message user";
//     userMsg.textContent = msg;
//     chatBox.appendChild(userMsg);

//     // Fetch AI reply
//     const res = await fetch(CHAT_URL, {
//         method: "POST",
//         headers: {"Content-Type": "application/json"},
//         body: JSON.stringify({message: msg})
//     });
//     const data = await res.json();

//     // AI message (left)
//     const botMsg = document.createElement("div");
//     botMsg.className = "chat-message bot";
//     botMsg.textContent = data.reply;
//     chatBox.appendChild(botMsg);

//     chatBox.scrollTop = chatBox.scrollHeight;
//     input.value = "";

//     // Reload tasks in case AI added/completed tasks
//     loadTasks();
// }

async function sendChat() {
    const input = document.getElementById("chatInput");
    const msg = input.value;
    if(!msg) return;

    const chatBox = document.getElementById("chatMessages");

    // Display user message
    const userMsg = document.createElement("div");
    userMsg.className = "chat-message user";
    userMsg.textContent = msg;
    chatBox.appendChild(userMsg);

    // Send to backend
    const res = await fetch("/chat", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({message: msg})
    });
    const data = await res.json();

    // Display AI reply
    const botMsg = document.createElement("div");
    botMsg.className = "chat-message bot";
    botMsg.textContent = data.reply;
    chatBox.appendChild(botMsg);

    chatBox.scrollTop = chatBox.scrollHeight;
    input.value = "";

    // Reload tasks list
    loadTasks();
}

// --- Initial load ---
loadTasks();
</script>
</body>
</html>
